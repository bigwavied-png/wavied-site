<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wavie D â€” Vault</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body class="vault-bg gold">

  <div class="vault-box">

    <!-- ðŸ”’ LOCKED -->
    <div id="vaultLocked" class="vault-section">
      <h2 class="vault-title">VAULT LOCKED</h2>

      <p>
        Exclusive unreleased content<br />
        <strong>$20 access required</strong>
      </p>

      <!-- IMPORTANT: class ADDED -->
      <button id="buyBtn" class="vault-buy-btn">
    
    </div>

    <!-- ðŸ”“ UNLOCKED -->
    <div id="vaultContent" class="vault-section hidden">
      <h2 class="vault-title">WELCOME TO THE VAULT</h2>

      <audio controls>
        <source src="music/vault-track.mp3" type="audio/mpeg" />
      </audio>
    </div>

  </div>

  <script>
    document.getElementById("buyBtn").addEventListener("click", async () => {
      try {
        const res = await fetch(
          "https://stripe-checkout.washington-10dee.workers.dev",
          { method: "POST" }
        );

        const data = await res.json();

        if (!data.url) {
          alert("Checkout failed.");
          return;
        }

        window.location.href = data.url;
      } catch (e) {
        alert("Checkout failed. Try again.");
        console.error(e);
      }
    });

    const params = new URLSearchParams(window.location.search);
    if (params.get("access") === "granted") {
      document.getElementById("vaultLocked")?.remove();
      document.getElementById("vaultContent")?.classList.remove("hidden");
    }
  </script>

</body>
</html>
